from lcu_driver import Connector
import colorama
import time
import os

client = Connector()
colorama.init()

async def get_name(cmd) -> bool:
    "Loldeki bağlantı kurulan hesabın adını gönderir."
    summoner = await cmd.request("GET", "/lol-summoner/v1/current-summoner")
    if summoner.status == 200:
        data: dict = await summoner.json()
        print(f"{colorama.Style.BRIGHT + colorama.Fore.GREEN + data['displayName'] + colorama.Style.RESET_ALL} ismiyle giriş yapıldı!")
        return True

    else:
        print(colorama.Style.BRIGHT + colorama.Fore.RED +
              "[HATA] Lol Arkada Açık Değil" + colorama.Style.RESET_ALL)
        return False

async def readyCheck(cmd) -> bool:
    "return queue accept"
    req = await cmd.request("GET", "/lol-matchmaking/v1/ready-check")
    if req.status != 200:
        return False
    data: dict = await req.json()
    if data['timer'] > 0.0:
        return True
    else: return False

async def accept(cmd) -> None:
    "accept match"
    req = await cmd.request("POST", "/lol-matchmaking/v1/ready-check/accept")
    if req.status == 204:
        print(colorama.Fore.GREEN + "[+] Oyun Kabul Edildi!" + colorama.Style.RESET_ALL)
    else:
        print(colorama.Fore.RED + "[-] Oyun Kabul Edilemedi!" + colorama.Style.RESET_ALL)

@client.ready
async def on(cmd) -> None:
    check = await get_name(cmd)
    print(colorama.Style.BRIGHT + colorama.Fore.BLUE + "[+] Kabul Etmek İçin Oyun Bekleniyor..." + colorama.Style.RESET_ALL)
    while True:
        x = await readyCheck(cmd)
        if x is True:
            await accept(cmd)
        time.sleep(0.1)

if __name__ == "__main__":
    os.system("@echo off")
    os.system("cls")
    print(colorama.Fore.GREEN + f"""
     ____  _____           _____ _           ____          _       ____  ___  ____  
    |  _ \|___ / _ __  ___|_   _| |__   ___ / ___|___   __| | ___ / ___|/ _ \|  _ \ 
    | |_) | |_ \| '_ \|_  / | | | '_ \ / _ \ |   / _ \ / _` |/ _ \ |  _| | | | | | |
    |  _ < ___) | | | |/ /  | | | | | |  __/ |__| (_) | (_| |  __/ |_| | |_| | |_| |
    |_| \_\____/|_| |_/___| |_| |_| |_|\___|\____\___/ \__,_|\___|\____|\___/|____/

                    {colorama.Fore.CYAN + "GitHub: https://github.com/R3nzTheCodeGOD" + colorama.Style.RESET_ALL}
    """)
    client.start()